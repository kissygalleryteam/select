/*! select - v1.4 - 2013-08-22 11:53:25 AM
* Copyright (c) 2013 明河; Licensed  */
KISSY.add("gallery/select/1.4/index",function(a,b,c,d){function e(b,c){var d=this,c=d._decorate(b,c);c.prefixCls||a.mix(c,{prefixCls:h}),e.superclass.constructor.call(d,c),d.set("target",b)}var f=b.all,g=c.Select,h="bf-",i=d.Item;return a.extend(e,g,{_decorate:function(b,c){var d=this;if(b=f(b),!b.length)return!1;c=c||{},c.elBefore=b;var e=d.menuData(b);return a.mix(c,{menu:a.mix(e.menu,c.menuCfg)}),a.mix(c,e.selectedItem),c},menuData:function(a){var b=this,a=a||b.get("target"),c=a.val(),d=a.all("option"),e={selectedItem:{},menu:{children:[]}};return d.each(function(a){var b={xclass:"option",content:a.text(),elCls:a.attr("class"),value:a.val(),prefixCls:h};c==a.val()&&(e.selectedItem={content:b.content,value:b.value}),e.menu.children.push(b)}),e},render:function(){var b=this;e.superclass.render.call(b);var c=b.get("target");return c.length?(c.hide(),b.on("afterValueChange",function(d){a.later(function(){c.val(d.newVal||""),c.fire("change"),b.fire("valueChange",{value:d.newVal,$select:c})})}),void 0):!1},sync:function(){var b=this,c=b.get("menu");if(!c)return b;b.removeItems(!0);var d=b.menuData(),e=d.selectedItem,f=d.menu.children;a.each(f,function(a){var c=new i(a);b.addItem(c),a.value==e.value&&(b.set("value",a.value),b.set("content",a.content))})}},{ATTRS:{target:{value:"",getter:function(a){return f(a)}}}}),e},{requires:["node","menubutton","menu"]});