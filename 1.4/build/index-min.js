/*! select - v1.4 - 2013-10-13 4:34:07 PM
* Copyright (c) 2013 明河; Licensed  */
KISSY.add("gallery/select/1.4/index",function(a,b,c,d){function e(b,c){var d=this;c.prefixCls||a.mix(c,{prefixCls:h}),c.elBefore||a.mix(c,{elBefore:f(b)}),e.superclass.constructor.call(d,c),d.set("target",b)}var f=b.all,g=c.Select,h="bf-",i="data-item",j=d.Item;return a.extend(e,g,{menuData:function(a){var b=this,a=a||b.get("target"),c=a.val(),d=a.all("option"),e={selectedItem:{},menu:{children:[]}};return d.each(function(a){var b={xclass:"option",content:a.text(),elCls:a.attr("class"),value:a.val(),prefixCls:h,elOption:a};c==a.val()&&(e.selectedItem={content:b.content,value:b.value}),e.menu.children.push(b)}),e},render:function(){var b=this;e.superclass.render.call(b);var c=b.get("target");return c.length?(c.hide(),b.sync(),b.on("afterValueChange",function(d){a.later(function(){c.val(d.newVal||""),c.fire("change"),b.fire("valueChange",{value:d.newVal,$select:c})})}),b._bind(),b.fire("render"),void 0):!1},_bind:function(){var a=this,b=a.get("menu");if(!b)return!1;var c=b.get("el");return c&&c.length?(c.on("mouseover",function(b){var c=f(b.target);if(c.hasClass("bf-menuitem")){var d=c.data(i);a.fire("itemMouseover",{$item:c,item:d})}}),void 0):!1},sync:function(){var b=this,c=b.get("menu");if(!c)return b;b.removeItems(!0);var d=b.menuData(),e=d.selectedItem,f=d.menu.children;a.each(f,function(a){var c=new j(a),d=a.elOption;d&&c.set("target",d),b.addItem(c);var f=c.get("el");f.data(i,c),a.value==e.value&&(b.set("value",a.value),b.set("content",a.content))}),b.fire("sync")}},{ATTRS:{target:{value:"",getter:function(a){return f(a)}}}}),e},{requires:["node","menubutton","menu"]});